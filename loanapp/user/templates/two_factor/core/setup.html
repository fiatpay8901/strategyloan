{% extends "user/base.html" %}
{% load i18n widget_tweaks %}

{% block title %}Enable Two-Factor Authentication{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-7">
    <div class="bg-white shadow-sm rounded p-4 mb-4">
      <h3 class="mb-3 text-primary">{% trans "Enable Two-Factor Authentication" %}</h3>
      <hr>
      <form method="post" novalidate>
        {% csrf_token %}
        {{ wizard.management_form }}
        {% if wizard.steps.current == 'welcome' %}
          <div class="alert alert-info">
            <strong>{% trans "Welcome!" %}</strong>
            <p class="mb-0">{% blocktrans trimmed %}You are about to take your account security to the next level. Follow the steps in this wizard to enable two-factor authentication.{% endblocktrans %}</p>
          </div>
          <button type="submit" class="btn btn-primary w-100 mt-3">{% trans "Next" %}</button>
        {% elif wizard.steps.current == 'method' %}
          <div class="alert alert-secondary">
            <p class="mb-0">{% blocktrans trimmed %}Please select which authentication method you would like to use.{% endblocktrans %}</p>
          </div>
          {% for field in wizard.form %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
              {{ field|add_class:"form-control" }}
              {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
              {% endif %}
              {% if field.errors %}
                <div class="text-danger small">{{ field.errors|striptags }}</div>
              {% endif %}
            </div>
          {% endfor %}
          <button type="submit" class="btn btn-primary w-100">{% trans "Next" %}</button>
        {% elif wizard.steps.current == 'generator' %}
          <div class="alert alert-info">
            <p>{% blocktrans trimmed %}To start using a token generator, please use your smartphone to scan the QR code below. For example, use Google Authenticator.{% endblocktrans %}</p>
            <div class="text-center my-3">
              <img src="{{ QR_URL }}" alt="QR Code" class="bg-white border rounded p-2"/>
            </div>
            <p>{% blocktrans trimmed %}Alternatively you can use the following secret to setup TOTP in your authenticator or password manager manually.{% endblocktrans %}</p>
            <div class="mb-2">
              <span class="badge bg-primary">{% translate "TOTP Secret:" %}</span>
              <span class="ms-2"><a href="{{ otpauth_url }}">{{ secret_key }}</a></span>
            </div>
            <p>{% blocktrans %}Then, enter the token generated by the app below.{% endblocktrans %}</p>
          </div>
          <div class="bg-light rounded p-4 mb-3">
            <form method="post" novalidate>
              {% csrf_token %}
              {{ wizard.management_form }}
              {% for field in wizard.form %}
                <div class="mb-3">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field|add_class:"form-control" }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                  {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <button type="submit" class="btn btn-primary w-100">Verify Token</button>
            </form>
          </div>
        {% elif wizard.steps.current == 'sms' %}
          <div class="alert alert-info">
            <p>{% blocktrans trimmed %}Please enter the phone number you wish to receive the text messages on. This number will be validated in the next step.{% endblocktrans %}</p>
          </div>
          <div class="bg-light rounded p-4 mb-3">
            <form method="post" novalidate>
              {% csrf_token %}
              {{ wizard.management_form }}
              {% for field in wizard.form %}
                <div class="mb-3">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field|add_class:"form-control" }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                  {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <button type="submit" class="btn btn-primary w-100">Continue</button>
            </form>
          </div>
        {% elif wizard.steps.current == 'call' %}
          <div class="alert alert-info">
            <p>{% blocktrans trimmed %}Please enter the phone number you wish to be called on. This number will be validated in the next step.{% endblocktrans %}</p>
          </div>
          <div class="bg-light rounded p-4 mb-3">
            <form method="post" novalidate>
              {% csrf_token %}
              {{ wizard.management_form }}
              {% for field in wizard.form %}
                <div class="mb-3">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field|add_class:"form-control" }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                  {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <button type="submit" class="btn btn-primary w-100">Continue</button>
            </form>
          </div>
        {% elif wizard.steps.current == 'validation' %}
          <div class="alert alert-info">
            <p>{% blocktrans trimmed %}Enter the code sent to your device to complete setup.{% endblocktrans %}</p>
          </div>
          <div class="bg-light rounded p-4 mb-3">
            <form method="post" novalidate>
              {% csrf_token %}
              {{ wizard.management_form }}
              {% for field in wizard.form %}
                <div class="mb-3">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field|add_class:"form-control" }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                  {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <button type="submit" class="btn btn-primary w-100">Verify Code</button>
            </form>
          </div>
        {% elif wizard.steps.current == 'yubikey' %}
          <div class="alert alert-info">
            <p>{% blocktrans trimmed %}Insert your YubiKey and touch it to generate a token.{% endblocktrans %}</p>
          </div>
          <div class="bg-light rounded p-4 mb-3">
            <form method="post" novalidate>
              {% csrf_token %}
              {{ wizard.management_form }}
              {% for field in wizard.form %}
                <div class="mb-3">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field|add_class:"form-control" }}
                  {% if field.help_text %}
                    <div class="form-text">{{ field.help_text }}</div>
                  {% endif %}
                  {% if field.errors %}
                    <div class="text-danger small">{{ field.errors|striptags }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <button type="submit" class="btn btn-primary w-100">Verify YubiKey</button>
            </form>
          </div>
        {% endif %}
      </form>
    </div>
  </div>
</div>
{% endblock %}